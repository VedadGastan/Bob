print("--- Testing Basic Types ---")

var nilValue = nil
var boolTrue = true
var boolFalse = false
var number = 42
var decimal = 3.14159
var negative = -10.5
var text = "Hello, Bob!"

print("nil:", nilValue)
print("bool:", boolTrue, boolFalse)
print("number:", number, decimal, negative)
print("string:", text)
print("")


print("--- Testing Arithmetic Operators ---")

var a = 10
var b = 3

print("Addition: 10 + 3 =", a + b)
print("Subtraction: 10 - 3 =", a - b)
print("Multiplication: 10 * 3 =", a * b)
print("Division: 10 / 3 =", a / b)
print("Modulo: 10 % 3 =", a % b)
print("Exponentiation: 2 ** 8 =", 2 ** 8)
print("")


print("--- Testing Comparison Operators ---")

print("10 == 10:", 10 == 10)
print("10 != 5:", 10 != 5)
print("10 > 5:", 10 > 5)
print("10 >= 10:", 10 >= 10)
print("5 < 10:", 5 < 10)
print("5 <= 5:", 5 <= 5)
print("")


print("--- Testing Logical Operators ---")

print("true and true:", true and true)
print("true and false:", true and false)
print("false or true:", false or true)
print("not true:", not true)
print("not false:", not false)
print("")


print("--- Testing Compound Assignment ---")

var x = 10
print("Initial x:", x)

x += 5
print("After x += 5:", x)

x -= 3
print("After x -= 3:", x)

x *= 2
print("After x *= 2:", x)

x /= 4
print("After x /= 4:", x)

x %= 5
print("After x %= 5:", x)
print("")


print("--- Testing Increment/Decrement ---")

var counter = 5
print("Initial counter:", counter)

var old = counter++
print("counter++ returns:", old, ", counter is now:", counter)

old = counter--
print("counter-- returns:", old, ", counter is now:", counter)
print("")


print("--- Testing String Operations ---")
var str1 = "Hello"
var str2 = "World"
var greeting = str1 + " " + str2
print("Concatenation:", greeting)

var repeated = "Ha" * 3
print("String repetition 'Ha' * 3:", repeated)

print("String length:", len("Hello"))
print("'o' in 'Hello':", "o" in "Hello")
print("'x' in 'Hello':", "x" in "Hello")

// String indexing
var word = "Hello"
print("word[0]:", word[0])
print("word[-1]:", word[-1])
print("")


print("--- Testing Arrays ---")
var arr = [1, 2, 3, 4, 5]
print("Array:", arr)
print("arr[0]:", arr[0])
print("arr[2]:", arr[2])
print("arr[-1]:", arr[-1])

arr[1] = 99
print("After arr[1] = 99:", arr)

push(arr, 6)
print("After push(arr, 6):", arr)

var popped = pop(arr)
print("Popped value:", popped)
print("Array after pop:", arr)

print("Array length:", len(arr))

// Mixed type array
var mixed = [1, "text", true, [1, 2, 3]]
print("Mixed array:", mixed)

// Membership test
print("3 in [1,2,3,4,5]:", 3 in [1, 2, 3, 4, 5])
print("10 in [1,2,3,4,5]:", 10 in [1, 2, 3, 4, 5])
print("")


print("--- Testing If/Elif/Else ---")
var score = 85

if (score >= 90) {
    print("Grade: A")
} elif (score >= 80) {
    print("Grade: B")
} elif (score >= 70) {
    print("Grade: C")
} else {
    print("Grade: F")
}
print("")


print("--- Testing While Loop ---")
var i = 0
while (i < 5) {
    print("While iteration:", i)
    i++
}
print("")


print("--- Testing For Loop ---")
for (var j = 0; j < 5; j++) {
    print("For iteration:", j)
}
print("")


print("--- Testing Functions ---")
func add(a, b) {
    return a + b
}

func greet(name) {
    print("Hello, " + name + "!")
}

func factorial(n) {
    if (n <= 1) {
        return 1
    }
    return n * factorial(n - 1)
}

print("add(5, 3):", add(5, 3))
greet("Bob")
print("factorial(5):", factorial(5))
print("")


print("--- Testing Closures ---")
func makeCounter() {
    var count = 0
    
    func increment() {
        count++
        return count
    }
    
    return increment
}

var counter1 = makeCounter()
var counter2 = makeCounter()

print("counter1():", counter1())
print("counter1():", counter1())
print("counter2():", counter2())
print("counter1():", counter1())
print("")


print("--- Testing First-Class Functions ---")
func multiply(a, b) {
    return a * b
}

var operation = multiply
print("operation(4, 5):", operation(4, 5))
print("")


print("--- Testing Math Functions ---")
print("sqrt(16):", sqrt(16))
print("pow(2, 10):", pow(2, 10))
print("abs(-42):", abs(-42))
print("floor(3.7):", floor(3.7))
print("ceil(3.2):", ceil(3.2))
print("round(3.5):", round(3.5))
print("sin(0):", sin(0))
print("cos(0):", cos(0))
print("tan(0):", tan(0))
print("log(2.71828):", log(2.71828))
print("")


print("--- Testing Utility Functions ---")
var rand = random()
print("random() (between 0 and 1):", rand)

var currentTime = time()
print("time() (milliseconds):", currentTime)

print("Sleeping for 100ms...")
sleep(100)
print("Done sleeping!")
print("")


print("--- Testing Truthiness ---")
if (nil) {
    print("nil is truthy")
} else {
    print("nil is falsy")
}

if (0) {
    print("0 is truthy")
} else {
    print("0 is falsy")
}

if ("") {
    print("empty string is truthy")
} else {
    print("empty string is falsy")
}

if ([]) {
    print("empty array is truthy")
} else {
    print("empty array is falsy")
}

if (42) {
    print("42 is truthy")
}

if ("text") {
    print("'text' is truthy")
}
print("")


print("--- Testing Nested Functions and Scope ---")
var globalVar = "global"

func outer() {
    var outerVar = "outer"
    
    func inner() {
        var innerVar = "inner"
        print("From inner - global:", globalVar)
        print("From inner - outer:", outerVar)
        print("From inner - inner:", innerVar)
    }
    
    inner()
}

outer()
print("")


print("--- Testing Complex Expressions ---")
var result = (5 + 3) * 2 - 10 / 2
print("(5 + 3) * 2 - 10 / 2 =", result)

var complex = 2 ** 3 + 5 * (10 - 3) / 2
print("2 ** 3 + 5 * (10 - 3) / 2 =", complex)
print("")


print("--- Testing Parallel Execution ---")
print("Number of threads available:", num_threads())

// Simple parallel loop
var sum = 0
atomic_store("sum", 0)

parallel (var k = 1; k <= 100; k++) {
    atomic_add("sum", k)
}

print("Parallel sum 1 to 100:", atomic_load("sum"))

// Parallel sum of squares
atomic_store("sumSquares", 0)

parallel (var m = 1; m <= 50; m++) {
    atomic_add("sumSquares", m * m)
}

print("Parallel sum of squares 1 to 50:", atomic_load("sumSquares"))
print("")


print("--- Testing Atomic Operations ---")
atomic_store("testVar", 10)
print("After atomic_store('testVar', 10):", atomic_load("testVar"))

atomic_add("testVar", 5)
print("After atomic_add('testVar', 5):", atomic_load("testVar"))

atomic_sub("testVar", 3)
print("After atomic_sub('testVar', 3):", atomic_load("testVar"))

atomic_inc("testVar")
print("After atomic_inc('testVar'):", atomic_load("testVar"))

atomic_dec("testVar")
print("After atomic_dec('testVar'):", atomic_load("testVar"))

var oldVal = atomic_xchg("testVar", 100)
print("atomic_xchg returned:", oldVal, ", new value:", atomic_load("testVar"))

var success = atomic_cas("testVar", 100, 200)
print("atomic_cas(100, 200) success:", success, ", value:", atomic_load("testVar"))

success = atomic_cas("testVar", 50, 300)
print("atomic_cas(50, 300) success:", success, ", value:", atomic_load("testVar"))
print("")


print("--- Testing Fibonacci (Recursive) ---")
func fib(n) {
    if (n <= 1) {
        return n
    }
    return fib(n - 1) + fib(n - 2)
}

print("Fibonacci sequence (first 10):")
for (var f = 0; f < 10; f++) {
    print("fib(" + f + ") =", fib(f))
}
print("")


print("--- Testing Array Filter Function ---")
func filterEven(arr) {
    var result = []
    for (var i = 0; i < len(arr); i++) {
        if (arr[i] % 2 == 0) {
            push(result, arr[i])
        }
    }
    return result
}

var numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
var evens = filterEven(numbers)
print("Original:", numbers)
print("Even numbers:", evens)
print("")


print("--- Testing Array Map Function ---")
func mapSquare(arr) {
    var result = []
    for (var i = 0; i < len(arr); i++) {
        push(result, arr[i] * arr[i])
    }
    return result
}

var nums = [1, 2, 3, 4, 5]
var squared = mapSquare(nums)
print("Original:", nums)
print("Squared:", squared)
print("")


print("=== ALL TESTS COMPLETED ===")
print("Bob language is working correctly!")