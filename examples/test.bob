// ============================================================================
// COMPREHENSIVE TEST SUITE FOR CUSTOM PROGRAMMING LANGUAGE
// ============================================================================
// This file tests all language features including:
// - Basic types and literals
// - Variables and assignments
// - Operators (arithmetic, comparison, logical)
// - Control flow (if/else, while, for)
// - Functions and recursion
// - Arrays and indexing
// - Built-in functions
// - Parallel loops and threading
// - Atomic operations
// - Edge cases and error conditions
// ============================================================================

print("========================================")
print("STARTING COMPREHENSIVE TEST SUITE")
print("========================================")
print("")

// ============================================================================
// TEST 1: BASIC LITERALS AND TYPES
// ============================================================================
print("TEST 1: Basic Literals and Types")
print("----------------------------------")

var testNum = 42
var testFloat = 3.14159
var testString = "Hello, World!"
var testBool = true
var testNil = nil
var testArray = [1, 2, 3, 4, 5]

print("Number:", testNum)
print("Float:", testFloat)
print("String:", testString)
print("Boolean:", testBool)
print("Nil:", testNil)
print("Array:", testArray)
print("Test 1 passed")
print("")

// ============================================================================
// TEST 2: ARITHMETIC OPERATIONS
// ============================================================================
print("TEST 2: Arithmetic Operations")
print("------------------------------")

var a = 10
var b = 3

print("Addition (10 + 3):", a + b)
print("Subtraction (10 - 3):", a - b)
print("Multiplication (10 * 3):", a * b)
print("Division (10 / 3):", a / b)
print("Modulo (10 % 3):", a % b)
print("Exponentiation (10 ** 3):", a ** b)
print("Negation (-10):", -a)
print("Test 2 passed")
print("")

// ============================================================================
// TEST 3: STRING OPERATIONS
// ============================================================================
print("TEST 3: String Operations")
print("-------------------------")

var str1 = "Hello"
var str2 = "World"
var str3 = str1 + " " + str2
print("Concatenation:", str3)

var repeated = "Hi" * 3
print("Repetition (\"Hi\" * 3):", repeated)

var contained = "ell" in "Hello"
print("Contains ('ell' in 'Hello'):", contained)

var strLen = len("Hello")
print("Length of 'Hello':", strLen)
print("Test 3 passed")
print("")

// ============================================================================
// TEST 4: COMPARISON OPERATORS
// ============================================================================
print("TEST 4: Comparison Operators")
print("-----------------------------")

var x = 10
var y = 20

print("10 == 10:", x == 10)
print("10 != 20:", x != y)
print("10 < 20:", x < y)
print("10 <= 10:", x <= 10)
print("20 > 10:", y > x)
print("20 >= 20:", y >= 20)
print("Test 4 passed")
print("")

// ============================================================================
// TEST 5: LOGICAL OPERATORS
// ============================================================================
print("TEST 5: Logical Operators")
print("--------------------------")

var t = true
var f = false

print("true and true:", t and t)
print("true and false:", t and f)
print("false or true:", f or t)
print("false or false:", f or f)
print("not true:", not t)
print("not false:", not f)
print("Test 5 passed")
print("")

// ============================================================================
// TEST 6: VARIABLE ASSIGNMENT AND COMPOUND ASSIGNMENT
// ============================================================================
print("TEST 6: Assignment Operators")
print("-----------------------------")

var counter = 10
print("Initial value:", counter)

counter = counter + 5
print("After += 5:", counter)

counter += 3
print("Using += 3:", counter)

counter -= 8
print("Using -= 8:", counter)

counter *= 2
print("Using *= 2:", counter)

counter /= 4
print("Using /= 4:", counter)

counter %= 3
print("Using %= 3:", counter)

counter++
print("After counter++:", counter)

counter--
print("After counter--:", counter)

print("Test 6 passed")
print("")

// ============================================================================
// TEST 7: ARRAYS
// ============================================================================
print("TEST 7: Array Operations")
print("-------------------------")

var arr = [10, 20, 30, 40, 50]
print("Array:", arr)
print("Length:", len(arr))
print("Element at index 0:", arr[0])
print("Element at index 2:", arr[2])
print("Element at index -1 (last):", arr[-1])
print("Element at index -2:", arr[-2])

arr[1] = 99
print("After arr[1] = 99:", arr)

var nested = [[1, 2], [3, 4], [5, 6]]
print("Nested array:", nested)
print("nested[1][0]:", nested[1][0])

var empty = []
print("Empty array:", empty)
print("Empty array length:", len(empty))

print("Test 7 passed")
print("")

// ============================================================================
// TEST 8: CONTROL FLOW - IF/ELSE
// ============================================================================
print("TEST 8: If/Else Control Flow")
print("-----------------------------")

var score = 85

if (score >= 90) {
    print("Grade: A")
} elif (score >= 80) {
    print("Grade: B")
} elif (score >= 70) {
    print("Grade: C")
} else {
    print("Grade: F")
}

var nested_test = 5
if (nested_test > 0) {
    print("Positive number")
    if (nested_test % 2 == 0) {
        print("Even")
    } else {
        print("Odd")
    }
}

print("Test 8 passed")
print("")

// ============================================================================
// TEST 9: CONTROL FLOW - WHILE LOOPS
// ============================================================================
print("TEST 9: While Loops")
print("--------------------")

var i = 0
var sum = 0
while (i < 5) {
    sum = sum + i
    i = i + 1
}
print("Sum of 0 to 4:", sum)

var countdown = 3
print("Countdown:")
while (countdown > 0) {
    print(countdown)
    countdown = countdown - 1
}
print("Liftoff!")

print("Test 9 passed")
print("")

// ============================================================================
// TEST 10: CONTROL FLOW - FOR LOOPS
// ============================================================================
print("TEST 10: For Loops")
print("-------------------")

var forSum = 0
for (var j = 0; j < 10; j++) {
    forSum = forSum + j
}
print("Sum of 0 to 9:", forSum)

var squares = [0, 0, 0, 0, 0]
for (var k = 1; k <= 5; k++) {
    squares[k - 1] = k * k
}
print("Squares of 1-5:", squares)

print("Test 10 passed")
print("")

// ============================================================================
// TEST 11: FUNCTIONS
// ============================================================================
print("TEST 11: Functions")
print("-------------------")

func add(x, y) {
    return x + y
}

func multiply(x, y) {
    return x * y
}

func greet(name) {
    return "Hello, " + name + "!"
}

func noReturn() {
    print("This function has no return value")
}

print("add(5, 3):", add(5, 3))
print("multiply(4, 7):", multiply(4, 7))
print("greet(\"Alice\"):", greet("Alice"))

var result = noReturn()
print("noReturn() returns:", result)

print("Test 11 passed")
print("")

// ============================================================================
// TEST 12: RECURSIVE FUNCTIONS
// ============================================================================
print("TEST 12: Recursive Functions")
print("-----------------------------")

func factorial(n) {
    if (n <= 1) {
        return 1
    }
    return n * factorial(n - 1)
}

func fibonacci(n) {
    if (n <= 1) {
        return n
    }
    return fibonacci(n - 1) + fibonacci(n - 2)
}

print("factorial(5):", factorial(5))
print("factorial(7):", factorial(7))
print("fibonacci(0):", fibonacci(0))
print("fibonacci(1):", fibonacci(1))
print("fibonacci(6):", fibonacci(6))
print("fibonacci(10):", fibonacci(10))

print("Test 12 passed")
print("")

// ============================================================================
// TEST 13: CLOSURES AND SCOPE
// ============================================================================
print("TEST 13: Closures and Scope")
print("----------------------------")

func makeCounter() {
    var count = 0
    
    func increment() {
        count = count + 1
        return count
    }
    
    return increment
}

var counter1 = makeCounter()
print("Counter1 call 1:", counter1())
print("Counter1 call 2:", counter1())
print("Counter1 call 3:", counter1())

var counter2 = makeCounter()
print("Counter2 call 1:", counter2())
print("Counter2 call 2:", counter2())

print("Test 13 passed")
print("")

// ============================================================================
// TEST 14: BUILT-IN MATH FUNCTIONS
// ============================================================================
print("TEST 14: Built-in Math Functions")
print("----------------------------------")

print("sqrt(16):", sqrt(16))
print("sqrt(25):", sqrt(25))
print("pow(2, 10):", pow(2, 10))
print("abs(-42):", abs(-42))
print("abs(42):", abs(42))
print("floor(3.7):", floor(3.7))
print("ceil(3.2):", ceil(3.2))
print("round(3.5):", round(3.5))
print("round(3.4):", round(3.4))

var angle = 3.14159 / 2
print("sin(π/2):", sin(angle))
print("cos(0):", cos(0))
print("tan(π/4):", tan(0.785398))

print("log(2.71828):", log(2.71828))
print("log(10):", log(10))

print("Test 14 passed")
print("")

// ============================================================================
// TEST 15: RANDOM AND TIME FUNCTIONS
// ============================================================================
print("TEST 15: Random and Time Functions")
print("------------------------------------")

print("Random number 1:", random())
print("Random number 2:", random())
print("Random number 3:", random())

var startTime = time()
print("Current timestamp:", startTime)

sleep(100)
var endTime = time()
print("Time after 100ms sleep:", endTime)
print("Elapsed time (should be ~100ms):", endTime - startTime)

print("Test 15 passed")
print("")

// ============================================================================
// TEST 16: ARRAY ALGORITHM - BUBBLE SORT
// ============================================================================
print("TEST 16: Array Algorithm - Bubble Sort")
print("---------------------------------------")

func bubbleSort(arr) {
    var n = len(arr)
    for (var i = 0; i < n - 1; i++) {
        for (var j = 0; j < n - i - 1; j++) {
            if (arr[j] > arr[j + 1]) {
                var temp = arr[j]
                arr[j] = arr[j + 1]
                arr[j + 1] = temp
            }
        }
    }
    return arr
}

var unsorted = [64, 34, 25, 12, 22, 11, 90]
print("Unsorted array:", unsorted)
var sorted = bubbleSort(unsorted)
print("Sorted array:", sorted)

print("Test 16 passed")
print("")

// ============================================================================
// TEST 17: ARRAY ALGORITHM - LINEAR SEARCH
// ============================================================================
print("TEST 17: Array Algorithm - Linear Search")
print("-----------------------------------------")

func linearSearch(arr, target) {
    for (var i = 0; i < len(arr); i++) {
        if (arr[i] == target) {
            return i
        }
    }
    return -1
}

var searchArray = [10, 23, 45, 67, 89, 12, 34]
print("Array:", searchArray)
print("Search for 67:", linearSearch(searchArray, 67))
print("Search for 12:", linearSearch(searchArray, 12))
print("Search for 100:", linearSearch(searchArray, 100))

print("Test 17 passed")
print("")

// ============================================================================
// TEST 18: PARALLEL LOOPS - BASIC TEST
// ============================================================================
print("TEST 18: Parallel Loops - Basic Test")
print("--------------------------------------")

var parallelSum = 0
atomic_store("parallelSum", 0)

print("Running parallel loop...")
var start = time()
parallel (var i = 0; i < 100; i++) {
    atomic_add("parallelSum", i)
}
var end = time()

var finalSum = atomic_load("parallelSum")
print("Parallel sum result:", finalSum)
print("Expected (0+1+...+99):", 4950)
print("Parallel execution time:", end - start, "ms")

print("Test 18 passed")
print("")

// ============================================================================
// TEST 19: PARALLEL VS SEQUENTIAL PERFORMANCE
// ============================================================================
print("TEST 19: Parallel vs Sequential Performance")
print("--------------------------------------------")

// Sequential version
var seqSum = 0
var seqStart = time()
for (var i = 0; i < 1000000; i++) {
    seqSum = seqSum + sqrt(i) * sqrt(i)
}
var seqEnd = time()
print("Sequential sum:", seqSum)
print("Sequential time:", seqEnd - seqStart, "ms")

// Parallel version
var parSum = 0
atomic_store("parSum", 0)
var parStart = time()
parallel (var i = 0; i < 1000000; i++) {
    var val = sqrt(i) * sqrt(i)
    atomic_add("parSum", val)
}
var parEnd = time()
parSum = atomic_load("parSum")
print("Parallel sum:", parSum)
print("Parallel time:", parEnd - parStart, "ms")
print("Speedup ratio:", (seqEnd - seqStart) / (parEnd - parStart))

print("Test 19 passed")
print("")

// ============================================================================
// TEST 20: ATOMIC OPERATIONS
// ============================================================================
print("TEST 20: Atomic Operations")
print("---------------------------")

atomic_store("counter", 0)
print("Initial value:", atomic_load("counter"))

atomic_inc("counter")
print("After increment:", atomic_load("counter"))

atomic_inc("counter")
print("After increment:", atomic_load("counter"))

atomic_dec("counter")
print("After decrement:", atomic_load("counter"))

atomic_add("counter", 10)
print("After add 10:", atomic_load("counter"))

atomic_sub("counter", 5)
print("After sub 5:", atomic_load("counter"))

var old = atomic_xchg("counter", 100)
print("After exchange (old value):", old)
print("New value:", atomic_load("counter"))

var success1 = atomic_cas("counter", 100, 200)
print("CAS 100->200 (should succeed):", success1)
print("Value after CAS:", atomic_load("counter"))

var success2 = atomic_cas("counter", 100, 300)
print("CAS 100->300 (should fail):", success2)
print("Value after failed CAS:", atomic_load("counter"))

print("Test 20 passed")
print("")

// ============================================================================
// TEST 21: PARALLEL LOOP WITH ARRAYS
// ============================================================================
print("TEST 21: Parallel Loop with Arrays")
print("-----------------------------------")

var results = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

parallel (var i = 0; i < 20; i++) {
    results[i] = i * i
}

print("Squares (parallel computation):", results)

print("Test 21 passed")
print("")

// ============================================================================
// TEST 22: COMPLEX FUNCTION - PRIME NUMBER CHECKER
// ============================================================================
print("TEST 22: Prime Number Checker")
print("------------------------------")

func isPrime(n) {
    if (n <= 1) return false
    if (n <= 3) return true
    if (n % 2 == 0 or n % 3 == 0) return false
    
    var i = 5
    while (i * i <= n) {
        if (n % i == 0 or n % (i + 2) == 0) {
            return false
        }
        i = i + 6
    }
    return true
}

print("isPrime(2):", isPrime(2))
print("isPrime(4):", isPrime(4))
print("isPrime(17):", isPrime(17))
print("isPrime(25):", isPrime(25))
print("isPrime(97):", isPrime(97))

var primes = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
var primeCount = 0
for (var n = 2; n < 50; n++) {
    if (isPrime(n)) {
        primes[primeCount] = n
        primeCount = primeCount + 1
    }
}
print("Primes less than 50:", primes)

print("Test 22 passed")
print("")

// ============================================================================
// TEST 23: THREAD INFO FUNCTIONS
// ============================================================================
print("TEST 23: Thread Info Functions")
print("--------------------------------")

print("Number of threads available:", num_threads())
print("Current thread ID:", thread_id())

print("Test 23 passed")
print("")

// ============================================================================
// TEST 24: RACE CONDITION TEST
// ============================================================================
print("TEST 24: Race Condition Test")
print("-----------------------------")

// This test demonstrates the importance of atomic operations
var raceCounter = 0
atomic_store("raceCounter", 0)

parallel (var i = 0; i < 500; i++) {
    var temp = atomic_load("raceCounter")
    atomic_store("raceCounter", temp + 1)
}

raceCounter = atomic_load("raceCounter")
print("Race counter (may not be 500 due to race):", raceCounter)

// Correct version using atomic_inc
var safeCounter = 0
atomic_store("safeCounter", 0)

parallel (var i = 0; i < 500; i++) {
    atomic_inc("safeCounter")
}

safeCounter = atomic_load("safeCounter")
print("Safe counter (should be 500):", safeCounter)

print("Test 24 passed")
print("")

// ============================================================================
// TEST 25: MATRIX MULTIPLICATION (Parallel vs Sequential)
// ============================================================================
print("TEST 25: Matrix Operations")
print("---------------------------")

func matrixMultiplySeq(A, B) {
    var rowsA = len(A)
    var colsA = len(A[0])
    var colsB = len(B[0])
    
    // Create result matrix with proper initialization
    var result = [[0, 0], [0, 0]]
    
    for (var i = 0; i < rowsA; i++) {
        for (var j = 0; j < colsB; j++) {
            var sum = 0
            for (var k = 0; k < colsA; k++) {
                sum = sum + A[i][k] * B[k][j]
            }
            result[i][j] = sum
        }
    }
    
    return result
}

var matA = [[1, 2, 3], [4, 5, 6]]
var matB = [[7, 8], [9, 10], [11, 12]]

print("Matrix A:", matA)
print("Matrix B:", matB)

var matC = matrixMultiplySeq(matA, matB)
print("Result A * B:", matC)

print("Test 25 passed")
print("")

// ============================================================================
// TEST 26: FIBONACCI SEQUENCE GENERATION
// ============================================================================
print("TEST 26: Fibonacci Sequence")
print("----------------------------")

func fibSequence(n) {
    if (n <= 0) return []
    if (n == 1) return [0]
    
    var fibs = [0, 1]
    
    for (var i = 2; i < n; i++) {
        // Use the new push function
        var next = fibs[i - 1] + fibs[i - 2]
        push(fibs, next)
    }
    
    return fibs
}

var fibSeq = fibSequence(15)
print("First 15 Fibonacci numbers:", fibSeq)

// ============================================================================
// TEST 27: STRING MANIPULATION
// ============================================================================
print("TEST 27: String Manipulation")
print("-----------------------------")

var original = "Hello, World!"
print("Original:", original)

var sentence = "The quick brown fox"
print("Sentence:", sentence)
print("Length:", len(sentence))

var testStr = "test"
print("Test string:", testStr)
print("Contains 'es':", "es" in testStr)
print("Contains 'xyz':", "xyz" in testStr)

print("Test 27 passed")
print("")

// ============================================================================
// TEST 28: GREATEST COMMON DIVISOR
// ============================================================================
print("TEST 28: Greatest Common Divisor")
print("----------------------------------")

func gcd(a, b) {
    while (b != 0) {
        var temp = b
        b = a % b
        a = temp
    }
    return a
}

print("gcd(48, 18):", gcd(48, 18))
print("gcd(100, 35):", gcd(100, 35))
print("gcd(17, 19):", gcd(17, 19))

print("Test 28 passed")
print("")

// ============================================================================
// TEST 29: STATISTICAL FUNCTIONS
// ============================================================================
print("TEST 29: Statistical Functions")
print("--------------------------------")

func mean(arr) {
    var sum = 0
    var n = len(arr)
    for (var i = 0; i < n; i++) {
        sum = sum + arr[i]
    }
    return sum / n
}

func standardDeviation(arr) {
    var avg = mean(arr)
    var sumSquaredDiff = 0
    var n = len(arr)
    
    for (var i = 0; i < n; i++) {
        var diff = arr[i] - avg
        sumSquaredDiff = sumSquaredDiff + (diff * diff)
    }
    
    return sqrt(sumSquaredDiff / n)
}

var data = [10, 12, 23, 23, 16, 23, 21, 16]
print("Data:", data)
print("Mean:", mean(data))
print("Standard Deviation:", standardDeviation(data))

print("Test 29 passed")
print("")

// ============================================================================
// TEST 30: PARALLEL COMPUTATION - PI ESTIMATION
// ============================================================================
print("TEST 30: Parallel Pi Estimation")
print("---------------------------------")
var piHits = 0
atomic_store("piHits", 0)
var iterations = 10000

parallel (var i = 0; i < iterations; i++) {
    var x = random()
    var y = random()
    
    if (x * x + y * y <= 1.0) {
        atomic_inc("piHits")
    }
}

var piEstimate = 4.0 * atomic_load("piHits") / iterations
print("Estimated Pi:", piEstimate)
print("Actual Pi: 3.14159...")
print("Error:", abs(piEstimate - 3.14159))

print("Test 30 passed")
print("")